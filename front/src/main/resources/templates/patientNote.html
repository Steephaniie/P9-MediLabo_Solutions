<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dossier Patient - Medilabo Solutions</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div th:replace="~{fragments/header :: header}"></div>

    <!-- Messages d'alerte -->
    <div th:if="${success}" class="alert alert-success">
      <span th:text="${success}"></span>
    </div>
    <div th:if="${error}" class="alert alert-danger">
      <strong>Erreur :</strong> <span th:text="${error}">Erreur</span>
    </div>
    <div th:if="${patientError}" class="alert alert-danger">
      <strong>Erreur :</strong> <span th:text="${patientError}">Erreur</span>
    </div>
    <div th:if="${noteError}" class="alert alert-danger">
      <strong>Erreur :</strong> <span th:text="${noteError}">Erreur</span>
    </div>

    <div class="mb-3 mt-5 w-75 mx-auto">
      <a
        th:href="@{'/front/patient/' + ${patient?.id} + '/edit'}"
        class="btn btn-primary"
      >
        Modifier le patient
      </a>
    </div>

    <!-- Résumé Patient -->
    <div class="w-75 mx-auto mb-4">
      <h2 class="mb-3">Résumé</h2>
      <div class="table-responsive">
        <table class="table table-striped">
          <tr>
            <th width="30%">ID Patient</th>
            <td th:text="${patient?.id}">123</td>
          </tr>
          <tr>
            <th>Nom complet</th>
            <td th:text="${patient?.firstname + ' ' + patient?.lastname}">
              Nom Prénom
            </td>
          </tr>
          <tr>
            <th>Date de naissance</th>
            <td
              th:text="${#temporals.format(patient?.birthDate, 'dd/MM/yyyy')}"
            >
              01/01/1990
            </td>
          </tr>
          <tr>
            <th>Genre</th>
            <td>
              <span
                th:text="${patient?.gender == 'M' ? 'Masculin' : 'Féminin'}"
                class="badge"
                th:classappend="${patient?.gender == 'M' ? 'bg-primary' : 'bg-info'}"
              >
              </span>
            </td>
          </tr>

          <tr>
            <th>Adresse</th>
            <td th:text="${patient?.address ?: 'Non renseignée'}">Adresse</td>
          </tr>
          <tr>
            <th>Téléphone</th>
            <td th:text="${patient?.phoneNumber ?: 'Non renseigné'}">
              Téléphone
            </td>
          </tr>
        </table>
      </div>
    </div>
    <!-- Notes Médicales -->
    <div>
      <div class="w-75 mx-auto mb-4">
        <h2 class="mb-3">Notes Médicales</h2>

        <div th:if="${notes != null and !notes.empty}">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Numéro</th>
                  <th>Note</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="note, iterStat : ${notes}">
                  <td th:text="${iterStat.count}">1</td>
                  <td th:text="${note.note}">Contenu de la note</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div th:if="${notes == null or notes.empty}" class="alert alert-info">
          <em>Aucune note médicale pour ce patient.</em>
        </div>

        <form
          th:action="@{'/front/note/' + ${patient?.id}}"
          method="post"
          th:object="${newNote}"
        >
          <div class="mb-3">
            <label for="noteTextarea" class="form-label fw-bold"
              >Nouvelle note médicale</label
            >
            <textarea
              id="noteTextarea"
              th:field="*{note}"
              class="form-control"
              rows="4"
              placeholder="Saisir la note médicale..."
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Ajouter la note</button>
        </form>
      </div>
    </div>
  </body>
</html>
